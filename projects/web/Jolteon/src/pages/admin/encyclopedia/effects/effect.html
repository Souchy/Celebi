<import from="../properties/propertygrid"></import>
<import from="../../../../components/modal/modal"></import>
<import from="./modelSelector/effectModelSelector"></import>
<import from="../zone/zone"></import>
<import from="./effectlist"></import>
<import from="../triggers/trigger/trigger"></import>
<import from="../triggers/triggerList/triggerList"></import>
<import from="../triggers/triggerModelSelector/triggerModelSelector"></import>

<!-- drag.trigger="e => onDrag(e)"  -->
<div if.bind="model">

  <div class="effecttitle">
    <!-- title -->
    <div class="effecttitletitle clickable" data-bs-toggle="collapse" data-bs-target="#collapseEffectContent-${model.entityUid}">
      <h5 click.trigger="clickMinimize()">${modelName}</h5>
      <h5 click.trigger="clickMinimize()">(${model.effectIds.length})</h5>
      <h5 click.trigger="clickMinimize()">${model.entityUid}</h5>
    </div>
    <button class="btn btn-floating" click.trigger="clickCopy()"><i class="fa-regular fa-copy"></i></button>
    <button class="btn btn-floating" click.trigger="clickPaste()"><i class="fa-regular fa-clipboard"></i></button>
    <button class="btn btn-floating" click.trigger="clickMoveUp()"><i class="fa-solid fa-angle-up"></i></button>
    <button class="btn btn-floating" click.trigger="clickMoveDown()"><i class="fa-solid fa-angle-down"></i></button>
    <!-- delete & confirm -->
    <button class="btn btn-floating" data-bs-toggle="modal" data-bs-target="#removeEffectModal-${model.entityUid}"><i class="fa-solid fa-xmark"></i></button>
    <modal id="removeEffectModal-${model.entityUid}" header="Remove effect?" close.bind=false footer.bind=true callbackok.bind="() => clickRemove()">
      Confirm remove ${modelName}?
    </modal>

  </div>

  <!-- content -->
  <!--  if.bind="!minimized" -->
  <div class="collapse show" id="collapseEffectContent-${model.entityUid}" if.bind="model">

    <!-- properties section -->
    <div class="effectSection d-flex">
      <div class="eblock">

        <!-- click.trigger="clickMinimize()"  -->
        <h6 class="clickable" data-bs-toggle="collapse" data-bs-target="#collapseZone-${model.entityUid}">Zone</h6>
        <zone zone.bind="model.targetAcquisitionZone" uid.bind="model.entityUid" callbacksave.bind="() => onSave()"></zone>
      </div>

      <div>
        <h6>Target Filter</h6>
        <condition if.bind="model.targetFilter" model.bind="model.targetFilter" callbacksave.bind="() => save()"></condition>
        <button else class="btn btn-floating">Set</button>
        <h6>Source Condition</h6>
        <condition if.bind="model.sourceCondition" model.bind="model.sourceCondition" callbacksave.bind="() => save()"></condition>
        <button else class="btn btn-floating">Set</button>
        <condition></condition>
      </div>

      <div>
        <h6>Triggers</h6>
        <trigger-list effect.bind="model" callbacksave.bind="() => saveTriggerList()"></trigger-list>
      </div>

      <div class="eblock" style="flex-grow: 1;">
        <h6>Schema</h6>
        <!-- change type -->
        <button class="btn btn-floating btn-changeSchema" data-bs-toggle="modal" data-bs-target="#effectSchemaTypeModal-${model.entityUid}">
          Change type
        </button>
        <modal id="effectSchemaTypeModal-${model.entityUid}" header="Change Schema Type" close.bind=false footer.bind=false>
          <effect-model-selector onselectcallback.bind="e => onChangeSchemaType(e)"></effect-model-selector>
        </modal>
        <!-- schema properties -->
        <propertygrid data.bind="model.schema" schema.bind="schema" uid.bind="model.entityUid" callbacksave.bind="() => onSave()"></propertygrid>
      </div>
    </div>

    <!-- children section -->
    <effectlist if.bind="model.effectIds" effectids.bind="model.effectIds" modaluid.bind="model.entityUid" callbacksave.bind="() => onSave()"></effectlist>

  </div>

</div>

<!-- modelUid -->
<!-- model name -->
<!-- model desc -->
<!-- model BoardTargetType -->
<!-- model propertySchemaType => property names -->

<!-- zone -->
<!-- conditions target -->
<!-- conditions caster -->
<!-- triggers -->
