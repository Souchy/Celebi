<import from="../../../components/modal/modal"></import>
<import from="../strings/stringcomponent"></import>
<import from="../stats/spell/spellstats"></import>
<import from="../effects/modelSelector/effectModelSelector"></import>
<import from="../effects/effect"></import>
<import from="../zone/zone"></import>
<import from="../stats/gen/statsmini"></import>


<!-- vignette root || creature -->
<template if.bind="isvignette && mode != 'search'">
  <!-- <a href="/editor/spell/{model.modelUid}"> -->
  <button class="btn title btn-outline" click.trigger="clickSpell()">
    <stringcomponent view-model.ref="name" uid.bind="model.nameId" editable.bind="!isvignette"></stringcomponent>
  </button>
  <!-- <button class="btn close" click.trigger="clickRemove()">x</button> -->
  
  <!-- delete & confirm -->
  <template if.bind="mode == 'creature'">
    <button class="btn close" data-bs-toggle="modal" data-bs-target="#removeSpell-${model.entityUid}">x</button>
    <modal id="removeSpell-${model.entityUid}" header="Remove Spell?" close.bind=false footer.bind=true callbackok.bind="() => clickRemove()">
      Confirm remove ${name.entity.value} from creature?
    </modal>
  </template>

  <template if.bind="mode == 'root'">
    <button class="btn close" data-bs-toggle="modal" data-bs-target="#deleteSpell-${model.entityUid}">x</button>
    <modal id="deleteSpell-${model.entityUid}" header="Delete Spell?" close.bind=false footer.bind=true callbackok.bind="() => clickRemove()">
      Confirm delete ${name.entity.value} entirely?
    </modal>
  </template>
</template>

<!-- vignette search -->
<template if.bind="isvignette && mode == 'search'">
  <div class="add">+</div>
  <button class="title titleSearch btn-outline" click.trigger="clickSpell()">
    <stringcomponent view-model.ref="name" uid.bind="model.nameId" editable.bind="!isvignette"></stringcomponent>
  </button>
</template>

<!-- full spell ui, not vignette -->
<template if.bind="!isvignette">
  <h2>Spell #${model.modelUid}</h2>
  <div class="d-flex">
    <stringcomponent view-model.ref="name" uid.bind="model.nameId" editable=true></stringcomponent>
    <stringcomponent view-model.ref="desc" uid.bind="model.descriptionId" editable=true large=true class="large"></stringcomponent>
  </div>
  <div>
    <button class="btn" click.trigger="clickFileExplorer">File</button>
    <input type="text" value.bind="model.icon" style="width: 200px;" change.trigger="save()"/>
  </div>
  <label class="btn" for="inputId">file dialog</label>
  <input id="inputId" type="file" style="position: fixed; top: -100em" files.bind="iconfile" change.trigger="f => clickFileIcon(f)">
  <!-- <div>
    ${filesStr}
  </div> -->

  <!-- costs + stats -->
  <div class="mainSpellProperties">
    <div>
      <h4>Costs</h4>
      <table class="table-striped table-sm table-borderless table-responsive-sm">
        <tbody>
          <tr repeat.for="charac of Characteristics.resourcesSpellCosts">
            <td>${charac.baseName}</td>
            <td><input type="number" value.bind="model.costs[charac.id]" change.trigger="onChangeCost(charac.id)" placeholder="0" /></td>
            <!-- <td>${charac.baseName} ${charac.id} ${model.costs[charac.id] || 0}</td> -->
          </tr>
        </tbody>
      </table>
    </div>
    <div>
      <h4>Stats</h4>
      <!-- <spellstats baseuid.bind="model.statsId"></spellstats> -->
      <statsmini statsuid.bind="model.statsId" characsallowed.bind="Characteristics.spellModels" hasadddelete.bind="true" hasgrowth.bind="true"></statsmini>
    </div>
    <div>
      <h4>Range</h4>
      <h6 class="clickable" data-bs-toggle="collapse" data-bs-target="#collapseZone-rangeMin">Zone Min</h6>
      <zone zone.bind="model.rangeZoneMin" uid="rangeMin" callbacksave.bind="() => save()"></zone>
      
      <h6 class="clickable" data-bs-toggle="collapse" data-bs-target="#collapseZone-rangeMax">Zone Max</h6>
      <zone zone.bind="model.rangeZoneMax" uid="rangeMax" callbacksave.bind="() => save()"></zone>
    </div>
  </div>

  <!-- effects -->
  <div if.bind="model">
    <h4>Effects</h4>
    <button class="btn" data-bs-toggle="modal" data-bs-target="#effectModelModal">Add</button>
    <modal id="effectModelModal" header="Add Spell Effect" close.bind=false footer.bind=false>
      <effect-model-selector onselectcallback.bind="e => addEffect(e)"></effect-model-selector>
    </modal>

    <div class="effectlist">
      <effect repeat.for="effectid of model.effectIds" uid.bind="effectid" callbackmoveup.bind="e => onMoveEffectUp(e)" callbackmovedown.bind="e => onMoveEffectDown(e)" callbackremove.bind="e => onRemoveEffect(e)"></effect>
    </div>
  </div>


</template>
